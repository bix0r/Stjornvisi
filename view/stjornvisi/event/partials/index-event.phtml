<div class="row half">
	<div class="column event-event-main">
		<article class="event">
			<header>
				<time>
					<?=$this->event->event_date->format('Y-m-d');?> |
					<?=($this->event->event_time)?$this->event->event_time->format('H:m'):'';?> |
					<?=($this->event->event_end)?$this->event->event_end->format('H:m'):'';?>
				</time>
				<h1><?=$this->event->subject?></h1>
				<ul class="event-groups-list">
					<?php if( count($this->event->groups)==0 ):?>
						<li>Stjórvísisviðburður</li>
					<?php else:?>
						<?php foreach( $this->event->groups as $group ):?>
							<li>
								<?php if($group->id == null):?>
									<span>Almennur viðburður</span>
								<?php else:?>
									<a href="<?=$this->url('hopur/index',array('id'=>$group->url))?>"><?=$group->name_short;?></a>
								<?php endif;?>
							</li>
						<?php endforeach;?>
					<?php endif;?>
				</ul>
			</header>
			<section>
				<?php if( $this->event->avatar):?>
					<img src="<?=$this->basePath("/images/100/{$this->event->avatar}")?>" />
				<?php endif;?>
				<?=$this->paragrapher($this->event->body);?>
				<h3><?=$this->event->location?></h3>
				<h3><?=$this->event->address?></h3>
			</section>
			<aside></aside>
			<footer>
				<?php if( ($this->event->event_date > new DateTime()) && $this->logged_in ):?>

					<?php if( $this->event->capacity == null || $this->event->capacity < count($this->event->attenders) ):?>

						<?php if($this->event->attending === null):?>
							ekki skráðu/ur inn
						<?php elseif($this->event->attending === false):?>
							<a href="<?=$this->url('vidburdir/attending',array('id'=>$this->event->id,'type'=>1))?>" class="attending yes" title="Skrá mætingu">mæti</a>
							<a href="<?=$this->url('vidburdir/attending',array('id'=>$this->event->id,'type'=>0))?>"  class="attending no" title="Afskrá mætingu">mæti ekki</a>
						<?php elseif($this->event->attending == 0):?>
							<a href="<?=$this->url('vidburdir/attending',array('id'=>$this->event->id,'type'=>1))?>" class="attending yes" title="Skrá mætingu">mæti</a>
							<span  class="attending no" title="Afskrá mætingu">mæti ekki</span>
						<?php elseif($this->event->attending == 1):?>
							<span class="attending yes" title="Skrá mætingu">mæti</span>
							<a href="<?=$this->url('vidburdir/attending',array('id'=>$this->event->id,'type'=>0))?>" class="attending no" title="Afskrá mætingu">mæti ekki</a>
						<?php endif;?>

					<?php else:?>
						<p class="bg-danger">Fullt á viðburðinn</p>
					<?php endif;?>

				<?php endif;?>
			</footer>
		</article>
		<?php if( (!$this->logged_in && $this->event->event_date > new DateTime()) && ($this->event->capacity == null || $this->event->capacity < count($this->event->attenders)) ):?>
			<div class="well well-lg">
				<form method="post" action="/vidburdir/<?=$this->event->id?>" class="form-inline">
					<?php if($this->register_message):?>
						<p>Skráning tókst, þú ættir að fá póst á næstu mínútum með staðfestingu</p>
					<?php else:?>
						<p>Þú virðist ekki vera skráð/ur inn</p>
						<p>Þú getur samt skráð þig á viðburðinn sem gestur með því að fylla út netfang hér fyrir neðan.</p>
					<?php endif;?>
					<div class="form-group">
						<input type="text" placeholder="Nafn" name="name" class="form-control" />
					</div>
					<div class="form-group">
						<input type="email" placeholder="Netfang" name="email" class="form-control" />
					</div>
					<input type="submit" class="btn btn-default" value="Skrá" />

				</form>
			</div>
		<?php else:?>
			<p class="bg-danger">Viðburður fullur</p>
		<?php endif;?>
		<?php if($this->access->is_admin || $this->access->type >= 1):?>
			<h2>Þátttakendur (<?=count($this->attendees)?>)</h2>
			<table>
				<thead>
				<tr>
					<td>#</td>
					<td>Nafn</td>
					<td>Titill</td>
					<td>Skráning</td>
				</tr>
				</thead>
				<tfoot>
				<tr>
					<td colspan="4">&nbsp;</td>
				</tr>
				</tfoot>
				<tbody>
				<?php foreach($this->attendees as $attendee):?>
					<tr>
						<td><?=@++$i?></td>
						<td>
							<?php if($attendee->id):?>
								<a href="<?=$this->url('notandi/index',array('id'=>$attendee->id))?>"><?=$attendee->name?></a>
							<?php else:?>
								<?=($attendee->name)?$attendee->name:$attendee->email;?>
							<?php endif;?>
						</td>
						<td>
							<?php if($attendee->title):?>
								<?=$attendee->title?>
							<?php else:?>
								&nbsp;
							<?php endif;?>
						</td>
						<td>
							<?=$attendee->register_time->format('Y-m-d H:i')?>
						</td>
					</tr>
				<?php endforeach;?>
				</tbody>

			</table>
		<?php endif;?>

	</div>

	<div class="column event-event-meta">

		<?php if( count($this->event->gallery)>0 ):?>
			<h1>Myndir</h1>
			<ul class="event-gallery-list">
				<?php foreach($this->event->gallery as $img):?>
					<li>
						<a href="<?=$this->basePath("/images/original/{$img->name}")?>" data-lightbox="gallery">
							<img src="<?=$this->basePath("/images/100/{$img->name}")?>" title="<?=$img->description?>" />
						</a>
					</li>
				<?php endforeach;?>
			</ul>
		<?php endif;?>

		<?php if($this->event->lat && $this->event->lng):?>
			<h1>Kort</h1>
			<div id="map_canvas" style="height:300px"></div>
			<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false">
			</script>
			<script type="text/javascript">
				function initialize() {
					var latlng = new google.maps.LatLng(<?=$this->event->lat?>, <?=$this->event->lng?>);
					var myOptions = {
						zoom: 15,
						center: latlng,
						mapTypeId: google.maps.MapTypeId.ROADMAP
					};
					var map = new google.maps.Map(document.getElementById("map_canvas"),
						myOptions);
					var marker = new google.maps.Marker({
						position: latlng
					});

					// To add the marker to the map, call setMap();
					marker.setMap(map);
				}
				initialize();
			</script>
		<?php endif;?>


		<?php if(count($this->event->reference)>0):?>
			<h1>Ítarefni</h1>
			<ul>
				<?php foreach($this->event->reference as $ref):?>
					<li><a href="<?=$this->basePath("/images/original/{$ref->name}")?>" title="<?=$ref->description?>" target="_blank"><?=$ref->name?></a></li>
				<?php endforeach;?>
			</ul>
		<?php endif;?>
	</div>
</div>